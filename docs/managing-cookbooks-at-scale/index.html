<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Managing Cookbooks at Scale - Sous Chefs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://sous-chefs.org/favicon.png">

  
  
  <link rel="stylesheet" href="/css/style.min.50fb62964ef97e7315a25ac15fe228450d210e0c6efcaf262b58716118310d4b.css">
  

  

</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="/docs/">
        <span>Docs</span>
      </a>
    </li>
    
    <li class="menu-item-minutes">
      <a href="/minutes/">
        <span>Minutes</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://sous-chefs.org/"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://sous-chefs.org/"><img alt="Logo" src="/images/logo.png" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="/docs/">
        <span>Docs</span>
      </a>
    </li>
    
    <li class="menu-item-minutes">
      <a href="/minutes/">
        <span>Minutes</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>


    
    
    
    
    
    
    
    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <h4>Docs</h4>
  <ul>
    
    <li class="active ">
      <a href="https://sous-chefs.org/docs/managing-cookbooks-at-scale/">Managing Cookbooks at Scale</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/cookbook-support/">Cookbook Support</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/sous-board-2019/">Community Leaders 2019</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/community-leaders/">Community Leaders Nominations 2019</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/chef-licensing-change/">Chef License Change</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/year-in-review/">2018 In Review</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/becoming-a-member/">Becoming a Member</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/code-of-conduct/">Code of Conduct</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/contributing/">Contributing to Sous Chefs</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/best-practices/">Cookbook Best Practices</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/forking/">Forking to Sous Chefs</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/departure/">Leaving Sous Chefs</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/licenses/">Licenses</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/membership/">Members</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/meetings/">Sous Chefs Meetings</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/transferring/">Transferring to Sous Chefs</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/board-nominations/">Board Nominations</a>
    </li>
    
    <li class="">
      <a href="https://sous-chefs.org/docs/chefconf-2017/">Chef Conf 2017 </a>
    </li>
    
  </ul>
</div>

          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Managing Cookbooks at Scale</h1>
<div class="content">
  <p>Sous-Chefs are a community organisation and like to think of ourselves as a home for unloved great cookbooks and as a place where these can always get released moving forward.</p>
<p>While these cookbooks are great, they are not always in the best of places, and when we recieve them there is significant work to bring them up to our standards.</p>
<p>We also have all our existing cookbooks (of which there are over 70) and as all organisations our standards change and we need to reflect this across all of our repositores.</p>
<h2 id="enter-the-bot-army">Enter the bot army</h2>
<p>We are an industry of DevOps practitioners and as part of that we aim to automate all of our world, and this is no exception. We have all personally spent many hours trying to keep all of our files in sync across our repositories.</p>
<p>To resolve this we have created 3 different bot applications, these are designed to each tackle one problem we had with managing our multitude of cookbooks.</p>
<h3 id="github-file-manager">Github-File-Manager</h3>
<p><a href="https://github.com/xorima/Github-File-Manager">Github File Manager</a> is designed to ensure static files which do not change are consistent across all Repositories, it uses a source repository and github topics to work out which repositores need these files to be put into them. They are issued as a pull request and allow us to start having the important conversations about what our files should actually look like, rather than spending all the time trying to keep them the same.</p>
<p>For us our source repository is <a href="https://github.com/sous-chefs/repo-management/tree/master/">Repo Management</a></p>
<p>In here we look in the path <code>standardfiles/cookbook</code> and ensure these files are identical in the discovered repositories, and if not the bot will issue pull requests to update the files</p>
<p>Examples of the files we manage:</p>
<ul>
<li><a href="https://github.com/danger/danger">Dangerfile</a></li>
<li><a href="https://github.com/features/actions">Github Actions</a></li>
<li><a href="https://help.github.com/en/github/building-a-strong-community/creating-a-default-community-health-file">Community files</a>, such as Code of Conduct</li>
</ul>
<h3 id="github-cookstyle-runner">Github-Cookstyle-Runner</h3>
<p><a href="https://github.com/xorima/Github-Cookstyle-Runner">Github Cookstyle Runner</a> was created to solve the problem all orginisations with large amounts of cookbooks have.</p>
<blockquote>
<p>I know I am meant to run cookstyle, but I don&rsquo;t have time to.</p>
</blockquote>
<p>This little app will find github repositories by Topic and run <code>cookstyle</code> against them, creating a pull request if changes are found with detailed messages for the changes, <a href="https://github.com/sous-chefs/java/pull/606">example</a>.</p>
<p>As an org we were very bad at keeping up to date with <code>cookstyle</code> fixes, which can unblock you, our users, from having failures on new versions of Chef Infra or in areas we made a mistake and just didn&rsquo;t realise.</p>
<h3 id="github-label-manager">Github-Label-Manager</h3>
<p><a href="https://github.com/xorima/Github-Label-Manager">Github Label Manager</a> is the final of the trio of bot applications we use to manage our repositories today, simply put it reads <code>json</code> files from a source repository, and ensures those labels (and optionally only those labels) exist on our cookbooks.</p>
<p>Now we could also have done this with our <a href="https://github.com/sous-chefs/terraform-github-org">Terraform Github Org</a> however we found in the past that this caused us to run out of github API calls far too quickly when needing to make multiple terraform changes.</p>
<h2 id="running-them">Running them</h2>
<p>Automation is at the heart of every solution in this industry, so itâ€™s not a surprise that a docker image was the best option for a deployable artefact.</p>
<p>We decided to use kubernetes for deployment purposes simply for the fact that as an org we rely on contributors to give up their free time, and the less time we are burning on build systems, bots and release systems the more time we have to do what we exist for, high quality cookbooks.</p>
<p>With the first run this week across <a href="https://github.com/sous-chefs">sous-chefs</a> and <a href="https://github.com/chef-cookbooks">chef-cookbooks</a> orgs we opened over 300 pull requests and of those 257 have already been merged, imagine how much time that saves</p>
<h2 id="future-of-the-bot-and-sous-chefs">Future of the Bot and Sous-Chefs</h2>
<ul>
<li>The apps themselves were written in a hackathon manner, which means almost no automated testing, so getting good testing is essential going forwards</li>
<li>Extending the File-Manager to handle deletion of files and introducing a tempalting enginer to build out files as we need for our READMEs as an example.</li>
<li>An automatic release system for our cookbooks, so one day a simple merge will automatically push these changes to the Supermarket, giving us more time to code and less time on maintenance.</li>
<li>Migrating the release of these applications into a hart package instead of the current system of static kubernetes manifests</li>
</ul>
<p>As always we are a group of volenteers and our doors are always open, so if you can help with any of this or want to get involved in some of the cookbooks we help to maintain, you can find us on the <a href="https://community-slack.chef.io/">Chef Community Slack</a> the the <code>#sous-chefs</code> channel</p>

</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li class="zerostatic"><a href="https://www.zerostatic.io">www.zerostatic.io</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  
  

  
  <script type="text/javascript" src="/js/scripts.min.bf1e1f7ae8e03db5f012356e825843facdff51c0a559cb0d27fe2bbe1db405c2.js"></script>
  

  
  
  
    
      
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130660686-1"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-130660686-1');
      </script>
    
  


</body>

</html>
